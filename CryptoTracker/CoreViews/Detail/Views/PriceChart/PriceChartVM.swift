//
//  PriceChartVM.swift
//  CryptoTracker
//
//  Created by shakir Gamzaev on 25/11/24.
//

import Foundation
import SwiftUI

struct PriceModel: Identifiable {
    let price: Double
    let date: Date
    var id: Date {
        return self.date
    }
}



@MainActor
@Observable
class PriceChartVM {
    var prices: [PriceModel]
    
    init(prices: [Double]) {
        let calendar = Calendar.current
        let startDate = calendar.startOfDay(for: calendar.date(byAdding: .day, value: -7, to: Date()) ?? Date())
        self.prices = []
        for (index, price) in prices.enumerated() {
            let priceDate = calendar.date(byAdding: .hour, value: index, to: startDate) ?? Date()
            let priceModel = PriceModel(price: price, date: priceDate)
            self.prices.append(priceModel)
        }
    }
    
    var maxPrice: Double {
        return prices.max(by: {$0.price < $1.price})?.price ?? 0
    }
    
    var minPrice: Double {
        return prices.min(by: {$0.price < $1.price})?.price ?? 0
    }
    
    var chartRange: Double {
        return maxPrice - minPrice
    }
    
    var yAxisTickInterval: Double {
        return chartRange / 4.0
    }
    
    var yTickValues: [Double] {
        var values: [Double] = []
        let initial = minPrice
        for i in 0..<4 {
            let value = initial + (Double(i) * yAxisTickInterval)
            values.append(value)
        }
        return values
    }
    
    var lineColor: Color {
        if !prices.isEmpty {
            if prices[0].price < prices[prices.count - 1].price {
                return Color.greenTheme
            }
            else {
                return Color.redTheme
            }
        }
        return Color.greenTheme
    }
}


extension PriceModel {
    static let samplePrices = [
                89838.92611345435,
                89713.2974868307,
                90162.77349580129,
                88887.30179103244,
                88823.31438192686,
                89483.7706056713,
                89409.77028722732,
                89300.57896422037,
                90652.17978589096,
                91248.48351283067,
                91665.90886209448,
                91238.90450238355,
                91291.13184524832,
                91202.15391359795,
                91237.18197916615,
                91453.604121957,
                91215.06529483231,
                91311.75041972323,
                91342.46379979319,
                91222.74745117137,
                91150.97623851735,
                91413.27815893771,
                91378.22771205618,
                91346.95272212593,
                91219.3763453195,
                90906.82691956821,
                90726.36234922895,
                91034.85815132981,
                90408.33984069523,
                90655.75248093979,
                90870.96561247803,
                91150.58676438485,
                91149.74066429886,
                90874.95664093895,
                91070.95704128424,
                90514.94439644078,
                90596.73623829268,
                90846.62542143103,
                89938.59171239202,
                90087.83651164154,
                90333.92767367949,
                90539.18066905202,
                90476.26743370442,
                90483.46776678428,
                90486.4857338097,
                91439.33865680735,
                91317.45124887433,
                91061.23145528007,
                90822.86009903326,
                90825.48811603468,
                90660.84137615387,
                90256.05816048072,
                90131.10088314643,
                90399.52801747111,
                90323.77402313882,
                89842.94527858608,
                90110.88013785047,
                89603.02798042569,
                89066.66384773863,
                89574.7472750456,
                89794.98179297929,
                89903.46721380035,
                90801.31767011418,
                90340.71621959737,
                90645.87831934931,
                90514.67560527523,
                90644.9533174999,
                92029.44836210483,
                91746.11220111935,
                91782.96182269306,
                91919.59014795092,
                91767.90419154741,
                90285.01150921201,
                90298.13249286894,
                89442.94912718928,
                90478.47813448591,
                92154.97215688135,
                91485.34763938113,
                91476.322349369,
                90445.4338930811,
                90755.97763639849,
                91836.7002239105,
                91350.09760408568,
                91145.90132219979,
                90456.69278677985,
                91112.08298031152,
                90739.2765548068,
                91292.99412165521,
                91438.42950386903,
                91664.69197868921,
                91947.31523152601,
                92041.9127881023,
                91799.88900321105,
                91816.20314892507,
                91765.54990542318,
                91844.09094193701,
                91725.19258632552,
                92496.84406606284,
                91310.01339915523,
                92070.43030671294,
                92381.59389111107,
                92586.920332828,
                93255.71143731456,
                93799.17681078352,
                93448.53147944646,
                92402.47461982082,
                92352.9515491435,
                91757.21183148149,
                92351.03033414358,
                92228.64839499166,
                91964.16429406262,
                91873.07999100645,
                92059.512957755,
                92203.16722966742,
                92682.26613335093,
                92393.58992607422,
                92867.73069351293,
                93270.15648899491,
                93231.830167103,
                93265.39728396996,
                93681.3448870722,
                94244.91495525278,
                94500.59284364933,
                94677.29717634007,
                94521.87295332563,
                94213.19992128732,
                94099.99665720656,
                93906.18229973842,
                94136.7839854972,
                94332.46496760551,
                94417.05325716126,
                94201.36172465737,
                94217.02229634205,
                94937.29947273481,
                94600.63819542028,
                94704.06449423352,
                95898.30691266003,
                97516.95025396596,
                97417.95197134383,
                97038.04937283573,
                97025.26655006359,
                97254.18628559289,
                97689.20968605207,
                98310.57038512541,
                98073.78757614846,
                97477.75806491218,
                97341.35546009081,
                96834.4357611275,
                96787.87259875108,
                97187.33504022115,
                98015.30989000655,
                98399.7881735672,
                98219.53058108511,
                98092.53289064155,
                98052.31813948065,
                98441.26161000447,
                98529.80211326091,
                98187.91803696626,
                98151.64835062402,
                98742.66590546833,
                98928.70808296709,
                98867.36644965629,
                98949.36085023009,
                99087.35895730593,
                99244.24438803681,
                98907.8290117248,
                98797.0488237581,
                98621.02826780382
    ]
}
